{
  "Dhcp4": {
    "interfaces-config": {
      "interfaces": ["*"]
    },
    "lease-database": {
      "type": "memfile",
      "persist": true,
      "name": "/var/lib/kea/dhcp4.leases"
    },
    "valid-lifetime": {{ kea_lease_time }},
    "renew-timer": 900,
    "rebind-timer": 1800,
    "option-data": [],
    "subnet4": [
{% for subnet in kea_subnet4 %}
      {
        "id": {{ loop.index }},
        "subnet": "{{ subnet.cidr }}",
        "pools": [
          { "pool": "{{ subnet.pool_start }} - {{ subnet.pool_end }}" }
        ],
        "routers": ["{{ subnet.router }}"],
        "option-data": [
          { "name": "domain-name", "data": "{{ subnet.domain }}" },
          { "name": "domain-name-servers", "data": "{{ subnet.dns_servers | join(', ') }}" }
        ],
        "reservations": [
{% for reservation in subnet.reservations | default([]) %}
          {
            "hw-address": "{{ reservation.hw_address }}",
            "ip-address": "{{ reservation.ip_address }}",
            "hostname": "{{ reservation.hostname }}"
          }{% if not loop.last %},{% endif %}
{% endfor %}
        ]
      }{% if not loop.last %},{% endif %}
{% endfor %}
    ],
    "dhcp-ddns": {
      "enable-updates": {{ kea_ddns_enable | default(false) | lower }},
      "qualifying-suffix": "{{ infra_domain }}",
      "server-ip": "{{ kea_ddns_server }}",
      "server-port": {{ kea_ddns_port }},
      "tsig-keys": [
        {
          "name": "{{ kea_ddns_key_name }}",
          "algorithm": "HMAC-SHA256",
          "secret": "{{ kea_ddns_key_secret }}"
        }
      ],
      "forward-ddns": {
        "ddns-domains": [
          {
            "name": "{{ infra_domain }}",
            "key-name": "{{ kea_ddns_key_name }}"
          }
        ]
      },
      "reverse-ddns": {
        "ddns-domains": [
          {
            "name": "{{ infra_reverse_zone }}",
            "key-name": "{{ kea_ddns_key_name }}"
          }
        ]
      }
    },
    "hooks-libraries": []
  }
}
