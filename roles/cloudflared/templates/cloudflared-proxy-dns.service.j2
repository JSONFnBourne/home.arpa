[Unit]
Description=Cloudflared DNS-over-HTTPS forwarder
After=network-online.target
Wants=network-online.target

[Service]
User={{ cloudflared_user }}
Group={{ cloudflared_group }}
ExecStart=/usr/bin/cloudflared --config {{ cloudflared_config_file }}{% if cloudflared_proxy_dns_extra_args | length > 0 %} {{ cloudflared_proxy_dns_extra_args | join(' ') }}{% endif %}

Restart=on-failure
RestartSec=2
AmbientCapabilities=CAP_NET_BIND_SERVICE
CapabilityBoundingSet=CAP_NET_BIND_SERVICE
NoNewPrivileges=true
LimitNOFILE=4096

[Install]
WantedBy=multi-user.target
